<form class="container p-0 mt-3 has-status-overlay" (submit)="onSubmit()">

  <h4>{{'phenology.observation.step4.title' | translate}}</h4>

  <h5>{{'phenology.observation.step4.section.tree' | translate}}</h5>

  <table class="table">
    <tbody>
    <tr>
      <th scope="row">ID</th>
      <td>{{selectedTree?.id}}</td>
    </tr>
    <tr>
      <th scope="row">{{'phenology.observation.step4.location' | translate}}</th>
      <td>{{selectedTree?.location?.street}}<br/>{{selectedTree?.location?.city}}</td>
    </tr>
    <tr>
      <th scope="row">{{'phenology.observation.step4.species' | translate}}</th>
      <td>{{selectedTree?.species}}</td>
    </tr>
    <tr>
      <th scope="row">{{'phenology.observation.step4.observation_time' | translate}}</th>
      <td>{{dataset?.observationDate}}</td>
    </tr>
    </tbody>
  </table>

  <h5>{{'phenology.observation.step4.section.observations' | translate}}</h5>

  <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
    <li *ngFor="let type of observationService.observationSpec" class="nav-item">
      <a class="nav-link active" id="{{type.name}}-tab" data-toggle="pill" href="#{{type.name}}-tab-content" role="tab" aria-controls="pills-home" aria-selected="true">
        {{'phenology.observation.type.' + type.name + '.name_plural' | translate}} <span class="badge badge-light">{{type.objects.length}}</span>
      </a>
    </li>
  </ul>
  <div *ngFor="let type of observationService.observationSpec" class="tab-content" id="{{type.name}}-tab-content">
    <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
      <table class="table">
        <tbody>
        <tr *ngFor="let r of type.results">
          <th scope="row">{{'phenology.observation.type.' + type.name + '.result.' + r.description | translate}}</th>
          <td>{{ getObservationResultAmount(r) }}</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

  <button class="btn btn-block btn-light" [routerLink]="['..', observationService.previousStep?.path]">
    {{'phenology.observation.step4.back_btn' | translate}}
  </button>
  <button class="btn btn-block btn-dark" type="submit"
    [disabled]="hasAnyStatus(StatusKey.SUBMISSION, StatusValue.IN_PROGRESS, StatusValue.SUCCESSFUL)">
    <i *ngIf="hasStatus(StatusKey.SUBMISSION, StatusValue.IN_PROGRESS)"
      class="fa fa-spin load-xs fa-refresh float-left"></i>
    {{'phenology.observation.step4.submit_btn' | translate}}
  </button>

  <div *ngIf="hasStatus(StatusKey.SUBMISSION, StatusValue.FAILED)" class="alert alert-danger mt-2" role="alert">
    Could not save your observation. Please try again in a few moments.<br/>
    If you refresh the page, your observation is lost!
  </div>

  <div *ngIf="hasStatus(StatusKey.SUBMISSION, StatusValue.SUCCESSFUL)" class="status-overlay overlay-fixed">
    <div class="status-overlay-content">
      <div class="status-overlay-heading heading-success">
        Success
      </div>
      <div class="status-overlay-text">
        Your observation has been successfully submitted.
        <p>
          <button class="btn btn-light float-right" routerLink="/phenology">Back to Phenology</button>
        </p>
      </div>
      <div class="status-overlay-controls">
          <button class="btn btn-light float-right" routerLink="/phenology">Back to Phenology</button>
      </div>
    </div>
  </div>

</form>
