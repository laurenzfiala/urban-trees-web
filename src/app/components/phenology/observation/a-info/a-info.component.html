<div class="container p-0 has-status-overlay">

  <div class="row">

    <div class="form-group col col-sm-6 col-md-auto">

      <label for="observationDate">{{'phenology.observation.step1.observation_date_label' | translate}}</label>
      <div class="input-group">
        <input type="text"
               id="observationDate"
               class="form-control"
               name="observationDate"
               #dp="bsDatepicker"
               bsDatepicker
               [bsConfig]="{ dateInputFormat: 'YYYY-MM-DD' }"
               [(ngModel)]="dataset.uiObservationDate"
               [maxDate]="dataset.uiMaxObservationDate">
        <div class="input-group-append">
          <button class="btn btn-outline-secondary" type="button" (click)="dp.toggle()">
            <i class="fa fa-calendar-o" aria-hidden="true"></i>
          </button>
        </div>
      </div>

    </div>

    <div class="form-group col col-sm-6 col-md-auto timepicker-container">

      <div class="input-group">
        <timepicker
          id="observationTime"
          name="observationTime"
          [(ngModel)]="dataset.uiObservationDate"
          [showMeridian]="false"
          [max]="dataset.uiMaxObservationDate">
        </timepicker>
      </div>

    </div>

  </div>

  <div *ngIf="hasStatus(StatusKey.TREES, StatusValue.IN_PROGRESS)" style="text-align: center; margin: 10%">
    <i class="fa fa-spin load-md fa-refresh"></i>
  </div>

  <div [ngClass]="{'hide-map': !hasStatus(StatusKey.TREES, StatusValue.SUCCESSFUL)}" class="form-group map-container">

    <div id="map" class="has-status-overlay" (click)="onMapClick($event)">
      <div *ngIf="hasStatus(StatusKey.MAP, StatusValue.IN_PROGRESS)" class="status-overlay center">
        <i class="fa fa-spin load-md fa-refresh"></i>
      </div>
      <div *ngIf="hasStatus(StatusKey.MAP, StatusValue.FAILED)" class="status-overlay">
        <div class="status-overlay-content">
          <div class="status-overlay-heading heading-danger">
            {{'general.error' | translate}}
          </div>
          <div class="status-overlay-text">
            {{'phenology.observation.step1.error_map.text' | translate}}
          </div>
          <div class="status-overlay-controls">
            <button class="btn btn-light float-right" (click)="load()" (keydown)="load()">{{'general.retry' | translate}}</button>
          </div>
        </div>
      </div>
      <div id="osm-copyright">&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a>
        contributors
      </div>
    </div>

    <ul class="list-group mt-2">
      <li *ngFor="let tree of this.trees"
          class="list-group-item list-group-item-action"
          [ngClass]="{'active': tree.selected}"
          (click)="selectTree(tree.id)"
          (keydown)="selectTree(tree.id)">
        <b>{{'tree.species.' + tree.species | lowercase | translate}}</b>
        <br/>
        {{'phenology.observation.step1.tree_location' | translate:tree.location}}
      </li>
    </ul>

  </div>

  <div *ngIf="hasStatus(StatusKey.TREES, StatusValue.IN_PROGRESS)" class="status-overlay center">
    <i class="fa fa-spin load-lg fa-refresh"></i>
  </div>
  <div *ngIf="hasStatus(StatusKey.TREES, StatusValue.FAILED)" class="status-overlay">
    <div class="status-overlay-content">
      <div class="status-overlay-heading heading-danger">
        {{'general.error' | translate}}
      </div>
      <div class="status-overlay-text">
        {{'phenology.observation.step1.error_loading.text' | translate}}
      </div>
      <div class="status-overlay-controls">
        <button class="btn btn-light float-right" (click)="load()" (keydown)="load()">{{'general.retry' | translate}}</button>
      </div>
    </div>
  </div>

</div>
