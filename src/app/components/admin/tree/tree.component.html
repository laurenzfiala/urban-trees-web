<ut-header></ut-header>

<div class="container mt-3">

  <h4>
    Add new tree
  </h4>

  <div class="text-subtle text-center mt-4">
    Select location
  </div>
  <hr class="mt-1" />

  <div class="row">
    <div class="col map-wrapper">
      <ut-map
        [userSetPin]="true"
        [(selectedMarker)]="marker">
      </ut-map>
    </div>
  </div>

  <div class="text-subtle text-center mt-4">
    Select properties
  </div>
  <hr class="mt-1" />

  <form class="mt-2">

    <div class="row">

    <!-- LOCATION - CITY -->
      <div class="col-sm-12 col-md-6 form-group">

        <label for="city">City</label>

        <div *ngIf="cities" class="form-row mb-2">
          <div class="col">
            <select id="city" name="citySelect" [(ngModel)]="selectedCity" class="form-control">
              <option *ngFor="let c of cities" [ngValue]="c" [attr.selected]="c.name === selectedCity ? true : null">{{c.name}}</option>
            </select>
          </div>
          <div class="col-auto">
            <div class="add-btn" (click)="showNewCityModal(newCityModal)"></div>
          </div>
        </div>

      </div>

      <!-- LOCATION - STREET -->
      <div class="col-sm-12 col-md-6 form-group">

        <label for="species">Street &amp; house number</label>

        <div class="form-row mb-2">
          <div class="col">
            <input [attr.disabled]="selectedCity ? null : true" class="form-control" type="text" name="street" [(ngModel)]="street" />
            <div *ngIf="!selectedCity" class="text-danger text-sm">
              Select city first.
            </div>
          </div>
        </div>

      </div>

    </div>

    <div class="row">

      <!-- SPECIES -->
      <div class="col-sm-12 col-md-6 form-group">

        <label for="species">Species</label>

        <div *ngIf="species" class="form-row mb-2">
          <div class="col">
            <select id="species" name="speciesSelect" [(ngModel)]="selectedSpecies" class="form-control">
              <option *ngFor="let s of species" [ngValue]="s">{{s.name}}</option>
            </select>
          </div>
        </div>
      </div>

    </div>

  </form>

  <hr />

  <div class="float-left mx-4">

    <span *ngIf="hasStatus(StatusKey.NEW_TREE, StatusValue.IN_PROGRESS)">Adding tree...</span>
    <span *ngIf="hasStatus(StatusKey.NEW_TREE, StatusValue.FAILED)">Tree could not be added.</span>
    <span *ngIf="hasStatus(StatusKey.NEW_TREE, StatusValue.TREE_MARKER_NOT_SET)">No tree marker was set. Not creating tree.</span>

  </div>

  <div class="text-right">

    <button class="btn btn-default mr-2" routerLink="/admin">Cancel</button>
    <button class="btn btn-primary" (click)="addTree()">Create Tree</button>

  </div>

</div>

<!-- NEW CITY MODAL -->
<ng-template #newCityModal>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Add new city</h4>
  </div>
  <div class="modal-body">
    Name of new city:
    <input [(ngModel)]="newCityName" type="text" class="form-control" />
  </div>
  <div class="modal-footer">
    <div class="float-left mx-4">
      <span *ngIf="hasStatus(StatusKey.NEW_CITY, StatusValue.IN_PROGRESS)">Adding city...</span>
      <span *ngIf="hasStatus(StatusKey.NEW_CITY, StatusValue.FAILED)">City could not be added.</span>
    </div>
    <button type="button" class="btn btn-secondary" (click)="hideNewCityModal()">Close</button>
    <button type="button" class="btn btn-primary" (click)="addCity()">Add city &amp; select</button>
  </div>
</ng-template>
